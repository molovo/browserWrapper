(function(a){a.fn.browserWrapper=function(b){var c={browserTitle:"Your Awesome Title",browserURL:"http://your.awesome.url.com",favicon:"http://browserwrapper.molovo.co.uk/img/favicon.png",filePath:"browserWrapper/src/",shadow:"0px 5px 15px rgba(0,0,0,0.3)",os:"mac",browser:"chrome",makeBrowserWork:!1,winVersion:"",theme:!1},b=a.extend(c,b),d=a(this);a(".browser-gui"),a(".browser-window-border"),a(".browser-gui .address-bar"),d.height(),d.width(),"windows"==c.os&&"windows7"!=c.winVersion&&(c.winVersion="windows8");var j=d.html();if(c.makeBrowserWork&&(j.match(/<iframe/)||j.match(/<object/))){var k='contenteditable="true"';d.data("originalURL",d.find("iframe").attr("src")||d.find("object").attr("data"))}if("detect"==c.os||"detect"==c.browser){var l={init:function(){this.browser=this.searchString(this.dataBrowser)||"chrome",this.OS=this.searchString(this.dataOS)||"mac"},searchString:function(a){for(var b=0;a.length>b;b++){var c=a[b].string,d=a[b].prop;if(this.versionSearchString=a[b].versionSearch||a[b].identity,c){if(-1!=c.indexOf(a[b].subString))return a[b].identity}else if(d)return a[b].identity}},dataBrowser:[{string:navigator.userAgent,subString:"Chrome",identity:"chrome"},{string:navigator.userAgent,subString:"Firefox",identity:"firefox"}],dataOS:[{string:navigator.platform,subString:"Win",identity:"windows"},{string:navigator.platform,subString:"Mac",identity:"mac"}]};l.init(),"detect"==c.os&&(c.os=l.OS),"detect"==c.browser&&(c.browser=l.browser)}if("mac"==c.os){var m='<img class="window-button red" src="'+c.filePath+'img/red-button.png" /><img class="window-button yellow" src="'+c.filePath+'img/yellow-button.png" />';m+=k?'<a class="window-button green" href="'+c.browserURL+'" target="_blank"><img src="'+c.filePath+'img/green-button.png" /></a>':'<img class="window-button green" src="'+c.filePath+'img/green-button.png" />'}else if("windows"==c.os)if(k)var m='<a class="window-button green '+c.winVersion+'" href="'+c.browserURL+'" target="_blank"><img src="'+c.filePath+"img/"+c.winVersion+'-buttons.png" /></a>';else var m='<img class="window-button green" src="'+c.filePath+"img/"+c.winVersion+'-buttons.png" />';if(c.browser&&"false"!==c.browser){var n='<span class="tab '+c.browser+'"><span class="tab-wrapper"><img class="favicon" src="'+c.favicon+'" /><span class="tabtext">'+c.browserTitle+"</span></span></span>",o='<div class="browser-gui-controls '+c.browser+'">';"chrome"==c.browser?(o+=k?'<a class="back-button"><img class="nav-buttons" src="'+c.filePath+"img/"+c.browser+'-back-button.png" /></a><a class="forward-button"><img class="nav-buttons" src="'+c.filePath+"img/"+c.browser+'-forward-button.png" /></a><a href="#" class="refresh-button"><img class="nav-buttons" src="'+c.filePath+"img/"+c.browser+'-refresh-button.png" /></a><a href="#" class="home-button"><img class="nav-buttons" src="'+c.filePath+"img/"+c.browser+'-home-button.png" /></a>':'<img class="nav-buttons" src="'+c.filePath+"img/"+c.browser+'-nav-buttons.png" />',o+='<span class="address-bar notsearch"><img class="address-bar-icon" src="'+c.filePath+'img/address-bar-icon.png" />'):"firefox"==c.browser&&(o+=k?'<a class="back-button"><img class="nav-buttons" src="'+c.filePath+"img/"+c.browser+'-nav-buttons.png" /></a>':'<img class="nav-buttons" src="'+c.filePath+"img/"+c.browser+'-nav-buttons.png" />',o+='<span class="address-bar notsearch"><img class="address-bar-icon" src="'+c.filePath+'img/address-bar-icon.png" />'),o+='<span class="address-bar-text" '+k+">"+c.browserURL+"</span>",o+="chrome"==c.browser?'<img class="address-bar-bookmark" src="'+c.filePath+"img/"+c.browser+'-address-bar-bookmark.png" /></span><img class="nav-button-settings" src="'+c.filePath+'img/nav-button-settings.png" />':"firefox"==c.browser?'<span class="address-bar-bookmark"><img class="address-bar-bookmark-button" src="'+c.filePath+"img/"+c.browser+'-address-bar-bookmark-button.png" /><a class="refresh-button"><img src="'+c.filePath+"img/"+c.browser+'-refresh-button.png" /></a></span></span><span class="address-bar firefox-google-search"><img class="address-bar-icon" src="'+c.filePath+'img/google-search-icon.png" /><span class="address-bar-text">Search Google</span></span>':"</span>",o+="</div>"}else o=" ",n=" ";var p='<div class="browser-window-controls '+c.os+" "+c.browser+'">'+m+n+"</div>";if(c.theme){a("head").append('<link rel="stylesheet" href="'+c.theme+'style.css" />');var q="";a.ajax({url:c.theme+"theme-info.json",type:"GET",dataType:"json",async:!1,success:function(a){q=a.name}}),d.addClass(q).load(c.theme+"content.html",function(){d.find(".browser-content-container").html(j),d.find(".tabtext").html(c.browserTitle),d.find(".address-bar-text").html(c.browserURL),d.find(".favicon").attr("src",c.favicon)})}else d.html('<div class="browser-window-border '+c.os+" "+c.winVersion+" "+c.browser+'" style="box-shadow:'+c.shadow+'">'+p+'<div class="browser-gui '+c.browser+'">'+o+j+"</div></div>").trigger("refresh");if(k){d.find(".home-button").attr("href",d.data("originalURL")),d.find(".refresh-button").attr("href",d.data("originalURL")),d.on("focus",".address-bar-text[contenteditable]",function(){var b=a(this);return d.data("before",b.html()),b}).on("blur keypress paste",".address-bar-text[contenteditable]",function(b){var c=b.keyCode||b.which;if(13!==c)return!0;b.preventDefault(),b.stopImmediatePropagation();var e=a(this);return d.data("before")!==e.html()&&e.trigger("change"),e}).find(".address-bar-text[contenteditable]").on("change",function(){var b=a(this),c=b.html();c.match(/^(https?|ftp):\/\/(.*)/)||(c="http://"+c),r.init(d,c)}),d.find(".back-button").on("click",function(b){b.preventDefault();var c=d.find("iframe").attr("src")||d.find("object").attr("data");return d.find(".forward-button").attr("href",c),r.init(d,a(this).attr("href")),!1}),d.find(".forward-button").on("click",function(b){b.preventDefault();var c=d.find("iframe").attr("src")||d.find("object").attr("data");return d.find(".back-button").attr("href",c),r.init(d,a(this).attr("href")),!1}),d.find(".refresh-button").on("click",function(a){a.preventDefault();var b=d.find("iframe").attr("src")||d.find("object").attr("data");return r.init(d,b),!1}),d.find(".home-button").on("click",function(a){a.preventDefault();var b=d.data("originalURL");return r.init(d,b),!1});var r={init:function(a,b){a.find("iframe").attr("src",b);var e=a.find("object").clone().attr("data",b);a.find("object").remove(),a.find(".browser-content").append(e);var f=b.split("/").splice(0,3).join("/")+"/favicon"+".ico";a.find(".favicon").attr("src",f),a.find(".tabtext").html(b),a.find(".address-bar-text").html(b),b!==c.browserURL?a.find(".back-button").attr("href",d.data("before")):a.find(".back-button").removeAttr("href"),d.data("before",b),a.find(".window-button.green").attr("href",b)}}}}})(jQuery);